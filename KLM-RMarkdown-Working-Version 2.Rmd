---
title: "Final Project"
author: "Katrina Lee Maxcy"
date: "3/15/17"
output: pdf_document
---

## Project Outline
Acute myeloid leukemia (AML) is a clinically devastating cancer (<30% 5 year-survival rate) that has been extraordinarily difficult to treat due to its complex genetic subtypes. One shared hallmark of AML is the arrest of leukemic myeloblasts at an immature and self-renewing stage of development.  Therapies that are able to overcome this arrest represent a powerful treatment strategy. Sykes et al developed a cellular model of HoxA9-enforced myeloid differentiation arrest to use in an unbiased phenotypic flow-cytometry based screen. In this system, 96-well and 384-well plates are treated with titrated small compounds in order to assess viability, changes in cellular phenotype (based on cell surface markers), and differentiation status (ie: are the cells able to overcome their differentiation arrest to take on a neutrophil phenotype versus a myeloblast progenitor phenotype). Compounds that allow for differentiation are considered "hits" in this system and should be further studied to identify details on mechanism of action and pharmacokinetics. Developing code to analyze the output (over 330,000 compounds will need to be tested at multiple doses) will be essential for quickly identifying "hits".

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

if(!require(tidyverse)){
  install.packages('tidyverse')
  require(tidyverse)
}
```

## Import File 
Import Excel file for analysis. The goal will be to set up a platform to analyze flow cytometry data from 96-well and 384-well plates for cell viability (determine whether compounds are overly toxic) and cell surface markers (determine changes in differentiation status) caused by treatment with DHODH inhibitor compounds.

``` {r echo=FALSE}
viability <- read.csv ("~/Desktop/R Final Project/R Test Viability 1.csv",
                       header = TRUE, stringsAsFactors = TRUE)
```

## Determine Viability Normalized to Control
Calculate viability as a percentage normalized to an average of the DMSO wells.

``` {r echo = FALSE}
DMSO_Average <- with(viability, sum(DMSO) / 8)
# I think you want all "Compound", columns right?
norm_viabilty <- viability[, grepl("Compound*", colnames(viability))] / DMSO_Average * 100

normviability <- viability[2:13] / DMSO_Average * 100
round(normviability, digits = 2)
normviability$Concentration <- viability[, "Concentration..uM."]
viability[, "Concentration..uM."] <- NULL
```

## Viability Curves

```{r pressure, echo=FALSE}
# I wouldn't use this library.  But I can walk you through how it works tonight
library(data.table)
data <- data.table(normviability)
melted_data <- melt(data, id.vars=c('Concentration', 'DMSO'),
     measure.vars = paste0('Compound.', c(1:11)),
     na.rm = TRUE)

melted_data[, Compound := gsub(pattern = "Compound.",
                  replacement="",
                  variable)]

library(ggplot2)
ggplot(data = melted_data,
       aes(x = Concentration, y = value, group = Compound, colour = Compound)) +
  geom_line() +
  geom_point() +
  ylab('Value') +
  scale_color_discrete("Compound")

ggplot(data = melted_data,
       aes(x = Concentration, y = value)) +
  geom_line() +
  geom_point() +
  ylab('Value') +
  facet_wrap(~ Compound)
# plot(viability$Concentration, viability$`Compound 1`, ylim = range(0, 100))
# change axes (Concentration to Concentration(uM) and Value to % Viability)
# Is it possible to reorder the list so compound 10/11 are at the end instead of after 1?
```

## Calculate IC50
Calculate the concentration at which 50% of the cells are dead. This value can be used in further validation studies.

1. Take concentration value from each graph coresponding to 50% on y-axis
2. Convert Concentration in uM to logM

## Calculate Differentiation
Determine which compounds cause differentiation of myeloblasts by calculating the percent of cells double-positive for Cd11b and GR-1, two cell surface markers of mature myeloid cells.

``` {r echo=FALSE}
differentiation <- read.csv ("~/Desktop/R Final Project/R Test Differentiation 1.csv",
                       header = TRUE, stringsAsFactors = TRUE)
```
``` {r echo = FALSE}
DMSO_Average <- with(differentiation, sum(DMSO) / 8)
norm_differentiation <- differentiation [, grepl("Compound*", colnames(viability))] - DMSO_Average 

PosCon_Average <- with(differentiation, sum(Compound 1) /8)
round(normviability, digits = 2)
normdifferentiation <- ((differentiation [3:12] - DMSO_Average_Differentiation) / PosCon_Average) * 100
```

# Graph Differentiation
Graph percent differentiation as a function of the positive control (Compound 1 in this example)
